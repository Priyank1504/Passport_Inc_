jQuery(function($){

	$('.money-mask').mask('#0.00', {reverse:true,maxlength:false});


	$.getJSON( "../JSON/state-abbrev-qnos.json.cfm", function( data ) {
		if(data !== null){
			for (var i = 0; i < data.length; i++) {
				transformStateAbbrevQuestions(data[i]);
			}
		}
	});

	

	transformStateAbbrevQuestions = function(questionNo){
		var myQuestionInput = $('#qid_1_'+questionNo);
		if(myQuestionInput.length > 0){

			var currVal = myQuestionInput.val();

			$.getJSON( "../JSON/postal-codes.json.cfm", function( data ) {


				var items = [];
					$.each( data, function( key, val ) {
					if(key == currVal)
						items.push( "<option selected value='" + key + "'>" + key + " - " + val + "</li>" );
					else
						items.push( "<option value='" + key + "'>" + key + " - " + val + "</li>" );
				});
				

				myQuestionInput.replaceWith(function() {

					return $( "<select/>", {
						"class": "form-control",
						html: items.join( "" )

					})	.attr('name',myQuestionInput.attr('name'))
						.attr('id',myQuestionInput.attr('id'))
						.attr('value',myQuestionInput.attr('value'))
						.data('type',myQuestionInput.data('type'));

			  	});	

				$('#qid_1_'+questionNo+' option').sort(NASort).appendTo('select');

			});
			
		}



	};
	
});

function NASort(a, b) {  
    if (a.innerHTML == 'NA') {
        return 1;   
    }
    else if (b.innerHTML == 'NA') {
        return -1;   
    }       
    return (a.innerHTML > b.innerHTML) ? 1 : -1;
}
